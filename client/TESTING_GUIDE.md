# Руководство по тестированию функционала сканирования

## Быстрый старт

### 1. Запуск приложения

```bash
cd /mnt/d/Projects/ozon-fbs-demo/client
npm run dev
```

### 2. Проверка интеграции

Убедитесь, что в вашем приложении есть группы заказов с товарами. Если нет, создайте тестовую поставку через интерфейс.

## Тестовые сценарии

### Сценарий 1: Базовое сканирование с проверкой МойСклад

1. Откройте группу заказов
2. Кликните на первый заказ (с бейджем "→ Доступен")
3. В модальном окне увидите детальную информацию
4. Введите баркод товара вручную: `2043855094983`
5. Должно появиться сообщение об успехе
6. Если товар в количестве > 1, повторите сканирование

**Ожидаемый результат**:
- Прогресс обновляется после каждого сканирования
- После сканирования всех товаров модальное окно закрывается
- Заказ помечается как обработанный

### Сценарий 2: Обработка ошибок

1. Откройте заказ
2. Введите неверный баркод: `9999999999999`

**Ожидаемый результат**:
- Появляется красное сообщение: "Штрихкод 9999999999999 не найден в заказе"
- Прогресс не изменился
- Поле ввода очищается

### Сценарий 3: Превышение количества

1. Откройте заказ с товаром (например, количество = 2)
2. Отсканируйте баркод 2 раза (товар полностью отсканирован)
3. Попытайтесь отсканировать баркод еще раз

**Ожидаемый результат**:
- Появляется сообщение: "Товар "..." уже отсканирован полностью (2 шт.)"
- Прогресс не изменился

### Сценарий 4: Последовательная обработка заказов

1. Откройте группу с несколькими заказами
2. Обратите внимание, что только первый заказ кликабелен
3. Попробуйте кликнуть на второй заказ

**Ожидаемый результат**:
- Второй заказ не открывается (opacity 0.6, cursor: not-allowed)
- Только первый заказ имеет синий бордер и бейдж "→ Доступен"

4. Обработайте первый заказ полностью
5. После закрытия модального окна проверьте список

**Ожидаемый результат**:
- Первый заказ помечен как обработанный (зеленый бордер, бейдж "✓ Обработан")
- Второй заказ стал кликабельным (синий бордер, бейдж "→ Доступен")

### Сценарий 5: Несколько товаров в заказе

1. Откройте заказ с несколькими разными товарами
2. Отсканируйте баркод первого товара
3. Отсканируйте баркод второго товара

**Ожидаемый результат**:
- Каждый товар независимо отслеживает свой прогресс
- После сканирования всех единиц товар помечается галочкой ✓
- Общий прогресс обновляется в заголовке модального окна
- После сканирования всех товаров появляется уведомление о завершении

### Сценарий 6: Безошибочная сборка с этикеткой

1. Откройте заказ с товарами
2. Отсканируйте все товары по очереди
3. После сканирования всех товаров появится уведомление "Все товары отсканированы!"
4. Появится поле для сканирования этикетки заказа
5. Введите баркод этикетки (номер заказа): например `79373559-0053-1`

**Ожидаемый результат**:
- После сканирования всех товаров появляется зеленое уведомление
- Появляется новое поле ввода для этикетки
- Фокус автоматически переключается на поле ввода этикетки
- После правильного сканирования этикетки появляется сообщение "Этикетка отсканирована успешно!"
- Через 1 секунду модальное окно закрывается
- Заказ помечается как обработанный

### Сценарий 7: Ошибка сканирования этикетки

1. Откройте заказ и отсканируйте все товары
2. В поле для сканирования этикетки введите неверный баркод: `WRONG-BARCODE`

**Ожидаемый результат**:
- Появляется красное сообщение: "Этикетка не прошла проверку"
- Поле ввода очищается
- Модальное окно не закрывается, можно повторить сканирование

### Сценарий 8: Проверка через МойСклад API

1. Откройте заказ с товаром, у которого есть артикул в МойСклад
2. Отсканируйте баркод товара
3. Система отправит запрос к МойСклад API для проверки

**Ожидаемый результат**:
- Появляется синее сообщение: "Проверка через МойСклад..."
- Если баркод найден в МойСклад - появляется зеленое сообщение об успехе
- Если баркод не найден - появляется красное сообщение: "Баркод не прошёл проверку МойСклад"
- Поле ввода блокируется во время проверки

## Тестовые данные

### Пример структуры заказа для тестирования

```json
{
  "postingNumber": "48068790BB",
  "shipmentDate": "2026-02-14T10:30:00Z",
  "products": [
    {
      "name": "Бенфотиамин + Альфа липоевая кислота + Теанин + коэнзим Q10",
      "offerId": "GRA-08080",
      "productId": "343898929",
      "quantity": 2,
      "barcode": "2043017893973"
    },
    {
      "name": "Физетин, 100 мг, 60 капсул",
      "offerId": "GRA-09100",
      "productId": "284381789",
      "quantity": 1,
      "barcode": "2038515111568"
    }
  ]
}
```

### Баркоды для ручного ввода

Используйте эти баркоды для тестирования:

```
2043017893973  - Бенфотиамин
2038515111568  - Физетин
2039961382502  - Ацетил l Карнитин
2042392959496  - Ежовик гребенчатый
2043855094983  - Лососевое масло
```

## Проверка UI/UX

### Визуальные элементы

✅ **Проверьте наличие:**
- Синий бордер на активном заказе
- Зеленый бордер на обработанном заказе
- Серый фон на недоступных заказах
- Бейджи "→ Доступен" и "✓ Обработан"
- Анимация пульсации на бейдже "→ Доступен"
- Прогресс-бары для каждого товара
- Галочки ✓ на полностью отсканированных товарах

### Интерактивность

✅ **Проверьте:**
- Курсор `pointer` на кликабельных заказах
- Курсор `not-allowed` на недоступных заказах
- Hover-эффект на кликабельных заказах (поднятие карточки)
- Автоматический фокус на поле ввода при открытии модального окна
- Очистка поля ввода после каждого сканирования

### Адаптивность

✅ **Протестируйте на разных разрешениях:**
- Desktop (1920x1080)
- Tablet (768x1024)
- Mobile (375x667)

## Отладка

### Консоль браузера

Откройте консоль разработчика (F12) для просмотра логов:

```javascript
✅ Заказ обработан: 48068790BB
✓ Товар "Физетин" отсканирован (1/1)
```

### Проверка состояния

В консоли можно проверить:

```javascript
// Список обработанных заказов
console.log(completedPostings);

// Текущий открытый заказ
console.log(selectedPosting);
```

## Частые проблемы

### Проблема: Баркоды не добавляются к товарам
**Решение**: Проверьте, что в `ShipmentGroupModal.jsx` используется `enrichedGroup.postings` вместо `group.postings`

### Проблема: Модальное окно не открывается
**Решение**: Убедитесь, что заказ является первым необработанным в списке

### Проблема: Сканирование не работает
**Решение**:
1. Проверьте, что баркод товара соответствует одному из товаров в заказе
2. Проверьте задержку в 200ms - возможно, нужно подождать после ввода

### Проблема: Стили не применяются
**Решение**:
1. Убедитесь, что `OrderDetailModal.css` импортирован в компонент
2. Очистите кеш браузера (Ctrl+Shift+R)

## Метрики производительности

Ожидаемое время выполнения операций:

- Открытие модального окна: < 100ms
- Сканирование баркода: < 300ms (включая задержку 200ms)
- Закрытие модального окна: ~500ms (включая анимацию)
- Обновление UI после завершения: < 100ms

## Чек-лист перед релизом

- [ ] Все тестовые сценарии пройдены успешно
- [ ] UI/UX элементы отображаются корректно
- [ ] Нет ошибок в консоли браузера
- [ ] Работает на всех поддерживаемых браузерах
- [ ] Адаптивность работает на всех разрешениях
- [ ] Производительность соответствует метрикам
- [ ] Обработка ошибок работает корректно
- [ ] Баркоды генерируются/применяются правильно
