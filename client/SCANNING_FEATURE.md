# Функционал сканирования товаров

## Описание

Реализован функционал для сканирования штрихкодов товаров в заказах с последовательной обработкой заказов в группе.

## Основные возможности

### 1. **Последовательная обработка заказов**
- При открытии группы заказов доступен для клика только первый необработанный заказ
- Заказ отмечен синим бордером и бейджем "→ Доступен"
- После завершения обработки текущего заказа автоматически становится доступным следующий
- Обработанные заказы отмечаются зеленым бордером и бейджем "✓ Обработан"

### 2. **Автоматическое сканирование штрихкодов**
- При вводе/сканировании штрихкода автоматически происходит проверка (задержка 200ms)
- Штрихкод сравнивается с баркодами товаров в заказе
- При успешном сканировании обновляется счетчик отсканированных товаров
- При ошибке показывается сообщение с описанием проблемы

### 3. **Отслеживание количества товаров**
- Если товар заказан в количестве > 1, нужно отсканировать соответствующее количество раз
- Прогресс отображается в формате "2 / 3" (отсканировано / всего)
- После сканирования всех единиц товара он помечается галочкой ✓

### 4. **Детальная информация о заказе**
- Номер заказа
- Дата и время заказа (в формате ЧЧ:ММ:СС)
- Список товаров с информацией:
  - Название
  - Баркод
  - Артикул продавца
  - Артикул OZON
  - Количество с прогрессом сканирования

## Созданные файлы

### Компоненты
1. **`OrderDetailModal.jsx`** - Модальное окно с детальной информацией о заказе и полем для сканирования
2. **`OrderDetailModal.css`** - Стили для модального окна

### Утилиты
3. **`barcodeUtils.js`** - Утилиты для работы с баркодами:
   - `generateBarcode(offerId)` - генерация баркода на основе артикула
   - `enrichPostingWithBarcodes(posting)` - добавление баркодов к товарам в заказе
   - `enrichGroupWithBarcodes(group)` - добавление баркодов ко всем заказам в группе
   - `isValidBarcode(barcode)` - проверка валидности баркода
   - `formatBarcode(barcode)` - форматирование баркода для отображения

### Модифицированные файлы
4. **`ShipmentGroupModal.jsx`** - Добавлена логика:
   - Отслеживание обработанных заказов
   - Определение доступного для клика заказа
   - Интеграция с OrderDetailModal
   - Автоматическое добавление баркодов к товарам

5. **`App.css`** - Добавлены стили для:
   - Кликабельных заказов (`.clickable`)
   - Недоступных заказов (`.disabled`)
   - Обработанных заказов (`.completed`)
   - Бейджей состояния (`.active-badge-inline`, `.completed-badge-inline`)

## Примеры баркодов для тестирования

В файле `barcodeUtils.js` добавлены реальные баркоды из test_my_sklad:

```javascript
'GRA-08020': '2043855094983'  // Лососевое масло для собак
'GRA-08080': '2043017893973'  // Бенфотиамин + Альфа липоевая кислота
'GRA-07813': '2042392959496'  // Ежовик гребенчатый
'GRA-09100': '2038515111568'  // Физетин
'GRA-04510': '2039961382502'  // Ацетил l Карнитин
```

## Как использовать

1. **Открыть группу заказов** - кликнуть на карточку группы в списке

2. **Выбрать первый заказ** - кликнуть на заказ с бейджем "→ Доступен"

3. **Сканировать товары** - в открывшемся модальном окне:
   - Поле ввода автоматически в фокусе
   - Сканируйте или введите штрихкод товара
   - Система автоматически проверит и обновит прогресс
   - Повторите для всех единиц товара

4. **Завершение** - после сканирования всех товаров:
   - Модальное окно автоматически закроется (через 500ms)
   - Заказ будет помечен как обработанный
   - Следующий заказ станет доступным

## Обработка ошибок

### Неверный штрихкод
```
Штрихкод 1234567890123 не найден в заказе
```

### Превышение количества
```
Товар "Физетин" уже отсканирован полностью (2 шт.)
```

## Логика работы на примере test_my_sklad

Функционал полностью повторяет логику из `test_my_sklad/src/views/EmployeeView.jsx`:

1. **Автоматическое сканирование** - использован таймер с задержкой 200ms (аналогично строкам 1156-1165)
2. **Проверка баркодов** - сравнение с товарами в заказе (аналогично handleScanSubmit)
3. **Последовательность заказов** - доступен только первый необработанный (аналогично логике в EmployeeView)

## Дальнейшие улучшения

Возможные улучшения функционала:

1. **Поддержка камеры** - интеграция с html5-qrcode для сканирования камерой
2. **Звуковые уведомления** - при успешном/неуспешном сканировании
3. **Сохранение прогресса** - сохранение состояния в localStorage
4. **Статистика** - время обработки заказа, количество ошибок
5. **Экспорт данных** - выгрузка информации о сканировании

## API для интеграции с бэкендом

Для полной интеграции потребуется создать endpoint:

```javascript
POST /api/orders/:orderId/scan
{
  "barcode": "2043855094983",
  "offerId": "GRA-08020",
  "scannedCount": 1
}

Response:
{
  "success": true,
  "product": {
    "offerId": "GRA-08020",
    "scanned": 1,
    "total": 2
  }
}
```
